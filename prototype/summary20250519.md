# Python数据处理与代码重构学习总结 - 2025年1月19日

## 📋 概述

今天的学习主要围绕三个核心主题：
1. **现代Python包管理工具** - uv工具的使用和优势
2. **高级Excel数据处理技巧** - 处理复杂的Excel错误和数据清洗
3. **代码结构重构** - 将单文件脚本重构为模块化项目

---

## 🔧 技术知识点分类

### 0. 现代Python包管理 (uv)

#### 0.1 uv工具简介
- **定义**: uv是一个极快的Python包安装器和解析器，用Rust编写
- **优势**: 比传统pip快10-100倍，更好的依赖解析
- **安装**: 通过官方安装脚本或包管理器安装

#### 0.2 uv vs pip 对比

| 特性 | pip | uv |
|------|-----|----|
| **速度** | 较慢 | 极快（10-100倍提升） |
| **依赖解析** | 基础解析 | 先进的SAT求解器 |
| **缓存机制** | 基础缓存 | 智能全局缓存 |
| **并行安装** | 有限支持 | 原生并行支持 |
| **错误信息** | 基础 | 详细且有用 |

#### 0.3 uv常用命令
```bash
# 安装包
uv pip install package_name

# 安装requirements.txt
uv pip install -r requirements.txt

# 创建虚拟环境
uv venv

# 激活虚拟环境（Windows）
.venv\Scripts\activate

# 列出已安装包
uv pip list

# 卸载包
uv pip uninstall package_name
```

#### 0.4 项目中的实际应用
- **问题场景**: 需要安装openpyxl库处理Excel文件
- **传统方式**: `pip install openpyxl`
- **uv方式**: `uv pip install openpyxl`
- **性能提升**: 安装速度显著提升，特别是在大型项目中

### 1. Python数据处理 (Pandas + Excel)

#### 1.1 依赖库管理
- **问题**: `ModuleNotFoundError: No module named 'openpyxl'`
- **解决方案**: 使用 `uv pip install openpyxl` 安装Excel处理库
- **知识点**: openpyxl是处理.xlsx文件的必需库
- **最佳实践**: 使用uv替代pip进行包管理，享受更快的安装速度

#### 1.2 正则表达式警告处理
- **问题**: `SyntaxWarning: invalid escape sequence '\s'`
- **原因**: Python字符串中的反斜杠转义序列解析问题
- **解决方案**: 使用原始字符串 `r'\s+'` 替代 `'\s+'`
- **最佳实践**: 在正则表达式中始终使用原始字符串

#### 1.3 Excel错误值处理

**核心挑战**: 保留Excel中的公式错误（如 `#REF!`, `#N/A`）

**技术方案对比**:

| 方法 | 优势 | 劣势 | 适用场景 |
|------|------|------|----------|
| `pd.read_excel()` | 简单快速 | 将错误转换为NaN，信息丢失 | 不需要保留错误信息 |
| `openpyxl` + 手动处理 | 完全保留原始错误 | 代码复杂度高 | 需要精确保留Excel状态 |
| `xlrd` (旧版本) | 可读取错误值 | 不支持新Excel格式 | 仅限.xls文件 |

**实现要点**:
```python
# 错误值保留的关键代码模式
if hasattr(cell, 'ctype') and cell.ctype == xlrd.XL_CELL_ERROR:
    error_code = cell.value
    if error_code == 23:  # #REF! 错误
        processed_value = '#REF!'
```

#### 1.4 数据清洗技巧
- **空格处理**: `df['列名'].apply(lambda x: x.strip() if isinstance(x, str) else x)`
- **数值转换**: `pd.to_numeric(df['列名'], errors='coerce')`
- **条件筛选**: 使用 `isin()` 方法进行多值匹配

### 2. 业务逻辑实现

#### 2.1 文件名驱动的数据筛选
- **通用规则**: 根据文件名（去除扩展名）筛选"销售"列
- **特殊规则**: "周敏.xls" 文件需要筛选 ['周敏', '待定', '#N/A'] 三个值
- **实现模式**: 使用条件分支处理不同文件的特殊需求

#### 2.2 数据合并与统计
- **列拼接**: 创建"合并列"（产品编号 + 站点 + 销售）
- **统计指标**: 总行数、空值行数、数值列求和
- **输出格式**: 结构化的统计报告

